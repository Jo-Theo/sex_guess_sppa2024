summary()
## there a lot of empty sessions :
# We erase them for rest of analysis since there is nothing to learn from it
# We erase them for rest of analysis since there is nothing to learn from it
list_empty <- list_empty_session(behav_session_bird_pred)
behav_session_not_empty <- remove_sessions(behav_session,list_empty)
behav_session_bird_pred_not_empty <- remove_sessions(behav_session_bird_pred,list_empty)
behav_session_bird_pred %>%
filter(!is.na(Flag)) %>%
pull(Flag)
behav_session_bird_pred %>%
write.csv2("Jo_dev/Data/flagged_behaviours_SPPA2024_1.csv", row.names = F)
## correction by session based on nb of bird pred before
corrected_behaviours <- add_missing_event_by_session(behaviours = behav_session_not_empty,
nb_bird_prediction = behav_session_bird_pred_not_empty$Nb_bird)
## check id any flags
corrected_behaviours_flag <-  guess_nb_of_bird_by_session(corrected_behaviours,
include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
### here still some flags !!!!!!!! To check or recucive correction
corrected_behaviours_flag <-  add_missing_event_by_session(corrected_behaviours,
corrected_behaviours_flag$Nb_bird) %>%
guess_nb_of_bird_by_session(include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
complete_behaviours <- corrected_behaviours_flag %>%
select(-Flag) %>%
filter(Activity %in% c("EX","EN"))
complete_behaviours %>%
write.csv2("Jo_dev/Data/complete_behaviours_SPPA2024_1.csv", row.names = F)
bouted_behav <- bouting_by_session(complete_behaviours)
any(bouted_behav$Bout_length<0)
bouted_behav %>% View()
sum(is.na(complete_behaviours$TimeAction))
complete_behaviours %>%
filter(is.na(TimeAction))
complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
# Session with time problems
complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
# Session with time action Na
complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
bouted_behav <- bouting_by_session(complete_behaviours)
# Session with time action Na
complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
# Session with time action Na
session_Na_time <- complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
source("~/Documents/2 - Travail/4 - Pardalotes2024/2 - Analyse/sex_guess/Jo_dev/3_real_data.R", echo=TRUE)
# .rs.restartR()
rm(list = ls(all.names = T))
##############################
### Packages and functions ###
##############################
source("jo_dev/dev/preprossesing_functions.R")
###################
### Import data ###
###################
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
################################
### Cleaning and exploration ###
################################
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
### Look at the number of cases
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
##############################################
### Estimation of bird number and flagging ###
##############################################
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
warnings()
## empty session or almost empty
behav_session_bird_pred %>%
split(.$Session) %>%
map_chr(~ifelse(max(.x$Nb_bird) == 2, "not empty",
ifelse(max(.x$Nb_bird) == 1, "Only one bird at a time",
ifelse(max(.x$Nb_bird) == 0,"No bird",'problem')))) %>%
as.factor() %>%
summary()
## there a lot of empty sessions :
# We erase them for rest of analysis since there is nothing to learn from it
# We erase them for rest of analysis since there is nothing to learn from it
list_empty <- list_empty_session(behav_session_bird_pred)
behav_session_not_empty <- remove_sessions(behav_session,list_empty)
behav_session_bird_pred_not_empty <- remove_sessions(behav_session_bird_pred,list_empty)
behav_session_bird_pred %>%
filter(!is.na(Flag)) %>%
pull(Flag)
behav_session_bird_pred %>%
write.csv2("Jo_dev/Data/flagged_behaviours_SPPA2024_1.csv", row.names = F)
#############################################
### Filling missing events and rechecking ###
#############################################
## correction by session based on nb of bird pred before
corrected_behaviours <- add_missing_event_by_session(behaviours = behav_session_not_empty,
nb_bird_prediction = behav_session_bird_pred_not_empty$Nb_bird)
## check id any flags
corrected_behaviours_flag <-  guess_nb_of_bird_by_session(corrected_behaviours,
include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
### here still some flags !!!!!!!! To check or recucive correction
corrected_behaviours_flag <-  add_missing_event_by_session(corrected_behaviours,
corrected_behaviours_flag$Nb_bird) %>%
guess_nb_of_bird_by_session(include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
# data is complete !
##################################
### Filtering other Activities ###
##################################
complete_behaviours <- corrected_behaviours_flag %>%
select(-Flag) %>%
filter(Activity %in% c("EX","EN"))
complete_behaviours %>%
write.csv2("Jo_dev/Data/complete_behaviours_SPPA2024_1.csv", row.names = F)
# Session with time action Na
session_Na_time <- complete_behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
session_Na_time %>%
map_lgl(~complete_behaviours %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())
# Session with time action Na
session_Na_time <- behaviours %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
# Session with time action Na
session_Na_time <- behaviours %>%
filter(is.na(AudRealTimeAction)) %>%
pull(Session) %>%
unique()
# Session with time action Na
session_Na_time <- behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())
keep <- !session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())
behav_session %>%
filter(Session %in% keep) %>%
View()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
!
behav_session %>%
filter(Session %in% keep)
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
!
m
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
!
p
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
!()
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
isFALSE()
session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`() %>%
session_Na_time[]
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`() %>%
wich()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`() %>%
which()
session_Na_time[keep]
behav_session %>%
filter(Session %in% session_Na_time[keep])
behav_session %>%
filter(Session %in% session_Na_time[keep]) %>%
View()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
# Session with time action Na
session_Na_time <- behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`() %>%
which()
session_Na_time[keep]
behav_session %>%
filter(Session %in% session_Na_time[keep]) %>%
View()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
# Session with time action Na
session_Na_time <- behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
`!`() %>%
which()
session_Na_time[keep]
behav_session %>%
filter(Session %in% session_Na_time[keep]) %>%
View()
source("~/Documents/2 - Travail/4 - Pardalotes2024/2 - Analyse/sex_guess/Jo_dev/3_real_data.R", echo=TRUE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y") %>%
filter(!is.na(TimeAction))
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y") %>%
filter(!is.na(TimeAction))
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
.rs.restartR()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y") %>%
filter(!is.na(TimeAction))
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
warnings()
behav_session_bird_pred %>%
split(.$Session) %>%
map_chr(~ifelse(max(.x$Nb_bird) == 2, "not empty",
ifelse(max(.x$Nb_bird) == 1, "Only one bird at a time",
ifelse(max(.x$Nb_bird) == 0,"No bird",'problem')))) %>%
as.factor() %>%
summary()
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
warnings()
behav_session_bird_pred %>%
split(.$Session) %>%
map_chr(~ifelse(max(.x$Nb_bird) == 2, "not empty",
ifelse(max(.x$Nb_bird) == 1, "Only one bird at a time",
ifelse(max(.x$Nb_bird) == 0,"No bird",'problem')))) %>%
as.factor() %>%
summary()
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y") %>%
filter(!is.na(TimeAction))
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
behav_session %>%
filter(Session == "PN24.NV04_2024-10-08")
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique() %>%
.[map_lgl(.,~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())]
# Session with time action Na
session_Na_time <- behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique()
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all()) %>%
which()
session_Na_time[keep]
session_Na_time[keep] == behav_session %>%
filter(is.na(TimeAction)) %>%
pull(Session) %>%
unique() %>%
.[map_lgl(.,~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())]
keep <- session_Na_time %>%
map_lgl(~behav_session %>%
filter(Session == .x) %>%
pull(TimeAction) %>%
is.na() %>%
all())
.rs.restartR()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
View(behav_session)
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/preprossesing_functions.R")
behaviours <- read.csv2("Jo_dev/Data/behaviours_SPPA2024_1.csv",
colClasses = "character", na.strings = "",
stringsAsFactors = FALSE)
behav_session <- cleaning_table(behaviours = behaviours,
other_activity = T,
date_format = "%d/%m/%Y")
c("Sex","Activity","Activity_code") %>%
map(~behav_session[.x] %>% summary())
behav_session_bird_pred <- guess_nb_of_bird_by_session(behaviours = behav_session,
include_flag = T)
warnings()
behav_session_bird_pred %>%
split(.$Session) %>%
map_chr(~ifelse(max(.x$Nb_bird) == 2, "not empty",
ifelse(max(.x$Nb_bird) == 1, "Only one bird at a time",
ifelse(max(.x$Nb_bird) == 0,"No bird",'problem')))) %>%
as.factor() %>%
summary()
## there a lot of empty sessions :
# We erase them for rest of analysis since there is nothing to learn from it
# We erase them for rest of analysis since there is nothing to learn from it
list_empty <- list_empty_session(behav_session_bird_pred)
behav_session_not_empty <- remove_sessions(behav_session,list_empty)
behav_session_bird_pred_not_empty <- remove_sessions(behav_session_bird_pred,list_empty)
behav_session_bird_pred %>%
filter(!is.na(Flag)) %>%
pull(Flag)
behav_session_bird_pred %>%
write.csv2("Jo_dev/Data/flagged_behaviours_SPPA2024_1.csv", row.names = F)
## correction by session based on nb of bird pred before
corrected_behaviours <- add_missing_event_by_session(behaviours = behav_session_not_empty,
nb_bird_prediction = behav_session_bird_pred_not_empty$Nb_bird)
## check id any flags
corrected_behaviours_flag <-  guess_nb_of_bird_by_session(corrected_behaviours,
include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
### here still some flags !!!!!!!! To check or recucive correction
corrected_behaviours_flag <-  add_missing_event_by_session(corrected_behaviours,
corrected_behaviours_flag$Nb_bird) %>%
guess_nb_of_bird_by_session(include_flag = T)
corrected_behaviours_flag %>%
filter(!is.na(Flag)) %>%
pull(Flag)
complete_behaviours <- corrected_behaviours_flag %>%
select(-Flag) %>%
filter(Activity %in% c("EX","EN"))
complete_behaviours %>%
write.csv2("Jo_dev/Data/complete_behaviours_SPPA2024_1.csv", row.names = F)
bouted_behav <- bouting_by_session(complete_behaviours)
any(bouted_behav$Bout_length<0)
bouted_behav %>%
write.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv", row.names = F)

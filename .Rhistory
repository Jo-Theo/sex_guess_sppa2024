}
get_bout_ind(behaviours,T)
bout_ind_behaviours <- get_bout_ind(behaviours,T)
bout_ind_behaviours %>%
bout_ind_behaviours
bout_ind_behaviours %>%
split(.$male_bout)
test = bout_ind_behaviours %>%
split(.$male_bout)
test[1]
test[[1]]
test[[1]][1,]
c("F_in","U_in","male_bout", "female_bout")
test[[1]][1,-c("F_in","U_in","male_bout", "female_bout")]
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/bout_manipulation.R")
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
sub_session_behaviours$Sub_session %>%
as.factor() %>%
summary() %>%
sort()
i <- 1
get_bout_ind <- function(behaviours, na_last_first = FALSE){
behaviours %>%
mutate(male_bout =  .indiv_bout_nb(behaviours$M_in, na_last_first),
female_bout = .indiv_bout_nb(behaviours$F_in, na_last_first))
}
behaviours <- sub_session_behaviours %>%
filter(Sub_session == unique(Sub_session)[i])
bout_ind_behaviours <- get_bout_ind(behaviours,T)
bout_ind_behaviours %>%
split(.$male_bout) %>%
map_dfr(function(bout){
res_bout <- bout[1,]
res_bout[c("F_in","U_in","male_bout", "female_bout")] <- NULL
res_bout$Sex <- "M"
res_bout$Nb_bird <- mean(bout$Nb_bird)
res_bout$Bout_length<- mean(bout$Bout_length)
res_bout %>%
rename(Bird_in = M_in)
})
bout_ind_behaviours %>%
split(.$male_bout)
bout_ind_behaviours %>%
split(.$male_bout) %>% names()
.contract_bout <- function(behaviours,male_bird = T){
if(male_bird){
split_by <- behaviours$male_bout
to_erase <- c("F_in","U_in","male_bout", "female_bout")
rename_this <- "M_in"
sex <- "M"
}else{
split_by <- behaviours$female_bout
to_erase <- c("M_in","U_in","male_bout", "female_bout")
rename_this <- "F_in"
sex <- "F"
}
behaviours %>%
split(split_by) %>%
map_dfr(function(bout){
res_bout <- bout[1,]
res_bout[to_erase] <- NULL
res_bout$Sex <- sex
res_bout$Nb_bird <- mean(bout$Nb_bird)
res_bout$Bout_length<- mean(bout$Bout_length)
res_bout %>%
rename_at(rename_this,~'Bird_in')
})
}
.contract_bout(bout_ind_behaviours,T)
.contract_bout(bout_ind_behaviours,F)
.contract_bout <- function(behaviours,male_bird = T){
if(male_bird){
split_by <- behaviours$male_bout
to_erase <- c("F_in","U_in","male_bout", "female_bout")
rename_this <- "M_in"
sex <- "M"
}else{
split_by <- behaviours$female_bout
to_erase <- c("M_in","U_in","male_bout", "female_bout")
rename_this <- "F_in"
sex <- "F"
}
behaviours %>%
split(split_by) %>%
map_dfr(function(bout){
res_bout <- bout[1,]
res_bout[to_erase] <- NULL
res_bout$Sex <- sex
res_bout$Nb_bird <- mean(bout$Nb_bird)
res_bout$Bout_length<- sum(bout$Bout_length)
res_bout %>%
rename_at(rename_this,~'Bird_in')
})
}
.contract_bout(bout_ind_behaviours,F)
behaviours <- sub_session_behaviours
sub_session_order <- unique(behaviours$Sub_session)
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(bout_ind_behaviours,male_bird = F),
.contract_bout(bout_ind_behaviours,male_bird = T)
) %>% # Bout each of them
mutate(Session = factor(Session,session_order)) %>% # reorder
arrange(Session)
})
.rs.restartR()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/bout_manipulation.R")
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
sub_session_behaviours$Sub_session %>%
as.factor() %>%
summary() %>%
sort()
.get_bout_ind <- function(behaviours, na_last_first = FALSE){
behaviours %>%
mutate(male_bout =  .indiv_bout_nb(behaviours$M_in, na_last_first),
female_bout = .indiv_bout_nb(behaviours$F_in, na_last_first))
}
.contract_bout <- function(behaviours,male_bird = T){
if(male_bird){
split_by <- behaviours$male_bout
to_erase <- c("F_in","U_in","male_bout", "female_bout")
rename_this <- "M_in"
sex <- "M"
}else{
split_by <- behaviours$female_bout
to_erase <- c("M_in","U_in","male_bout", "female_bout")
rename_this <- "F_in"
sex <- "F"
}
behaviours %>%
split(split_by) %>%
map_dfr(function(bout){
res_bout <- bout[1,]
res_bout[to_erase] <- NULL
res_bout$Sex <- sex
res_bout$Nb_bird <- mean(bout$Nb_bird)
res_bout$Bout_length<- sum(bout$Bout_length)
res_bout %>%
rename_at(rename_this,~'Bird_in')
})
}
behaviours <- sub_session_behaviours
sub_session_order <- unique(behaviours$Sub_session)
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(bout_ind_behaviours,male_bird = F),
.contract_bout(bout_ind_behaviours,male_bird = T)
) %>% # Bout each of them
mutate(Session = factor(Session,session_order)) %>% # reorder
arrange(Session)
})
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
) %>% # Bout each of them
mutate(Session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
})
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)# %>% # Bout each of them
# mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
# arrange(Sub_session)
})
sub_session_order <- unique(behaviours$Sub_session)
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
})
sub_session_behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
exctract_individual_bout <- function(behaviours){
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
# .rs.restartR()
rm(list = ls(all.names = T))
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
source("jo_dev/dev/bout_manipulation.R")
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
sub_session_behaviours$Sub_session %>%
as.factor() %>%
summary() %>%
sort()
.get_bout_ind <- function(behaviours, na_last_first = FALSE){
behaviours %>%
mutate(male_bout =  .indiv_bout_nb(behaviours$M_in, na_last_first),
female_bout = .indiv_bout_nb(behaviours$F_in, na_last_first))
}
.contract_bout <- function(behaviours,male_bird = T){
if(male_bird){
split_by <- behaviours$male_bout
to_erase <- c("F_in","U_in","male_bout", "female_bout")
rename_this <- "M_in"
sex <- "M"
}else{
split_by <- behaviours$female_bout
to_erase <- c("M_in","U_in","male_bout", "female_bout")
rename_this <- "F_in"
sex <- "F"
}
behaviours %>%
split(split_by) %>%
map_dfr(function(bout){
res_bout <- bout[1,]
res_bout[to_erase] <- NULL
res_bout$Sex <- sex
res_bout$Nb_bird <- mean(bout$Nb_bird)
res_bout$Bout_length<- sum(bout$Bout_length)
res_bout %>%
rename_at(rename_this,~'Bird_in')
})
}
exctract_individual_bout <- function(behaviours){
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
exctract_individual_bout(sub_session_behaviours)
extract_individual_bout <- function(behaviours){
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
individual_bout <- extract_individual_bout(sub_session_behaviours)
library(furrr)
extract_individual_bout <- function(behaviours){
# Set a "plan" for how the code should run.
plan(multisession, workers = 3)
# This does run in parallel!
future_map(c("hello", "world"), ~.x)
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
future_map2_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
individual_bout <- extract_individual_bout(sub_session_behaviours)
extract_individual_bout <- function(behaviours){
# Set a "plan" for how the code should run.
plan(multisession, workers = 3)
# This does run in parallel!
future_map(c("hello", "world"), ~.x)
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
future_map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
individual_bout <- extract_individual_bout(sub_session_behaviours)
extract_individual_bout <- function(behaviours){
# Set a "plan" for how the code should run.
plan(multisession, workers = 3)
# This does run in parallel!
future_map(c("hello", "world"), ~.x)
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session)
}
individual_bout <- extract_individual_bout(sub_session_behaviours)
View(individual_bout)
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/bout_manipulation.R")
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
sub_session_behaviours$Sub_session %>%
as.factor() %>%
summary() %>%
sort()
individual_bout <- extract_individual_bout(sub_session_behaviours)
View(individual_bout)
View(individual_bout)
plot(denstity(individual_bout$Bout_length))
plot(density(individual_bout$Bout_length))
library(ggplot2)
ggplot(individual_bout, aes(x = Bout_length, fill = Sex)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by sex",
x = "Bout length",
y = "Density") +
theme_minimal()
ggplot(individual_bout, aes(x = Bout_length, fill = Pair)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
individual_bout %>%
ggplot(aes(x = Bout_length, fill = Pair)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
individual_bout %>%
mutate(Pair = as.factor(Pair)) %>%
ggplot(aes(x = Bout_length, fill = Pair)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
View(individual_bout)
extract_individual_bout <- function(behaviours){
sub_session_order <- unique(behaviours$Sub_session)
behaviours %>%
split(.$Sub_session) %>%
map_dfr(function(sub_session){
sub_session <- .get_bout_ind(sub_session, na_last_first = T)
bind_rows(
.contract_bout(sub_session,male_bird = F),
.contract_bout(sub_session,male_bird = T)
)
}) %>% # Bout each of them
mutate(Sub_session = factor(Sub_session,sub_session_order)) %>% # reorder
arrange(Sub_session) %>%
mutate(Id_bird = paste0(Pair,"_",Sex))
}
ggplot(aes(x = Bout_length, fill = ID_bird)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
# .rs.restartR()
rm(list = ls(all.names = T))
source("jo_dev/dev/bout_manipulation.R")
.rs.restartR()
behaviours <- read.csv2("Jo_dev/Data/bouted_behaviours_SPPA2024_1.csv")
# defining sub_session
sub_session_behaviours <- sub_session_by_session(behaviours, length_min = 1)
sub_session_behaviours$Sub_session %>%
as.factor() %>%
summary() %>%
sort()
individual_bout <- extract_individual_bout(sub_session_behaviours)
individual_bout %>%
ggplot(aes(x = Bout_length, fill = Sex)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by sex",
x = "Bout length",
y = "Density") +
theme_minimal()
individual_bout %>%
mutate(Pair = as.factor(Pair)) %>%
ggplot(aes(x = Bout_length, fill = Pair)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
individual_bout
individual_bout %>%
ggplot(aes(x = Bout_length, fill = ID_bird)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
View(individual_bout)
individual_bout %>%
ggplot(aes(x = Bout_length, fill = Id_bird)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
View(behaviours)
individual_bout %>%
ggplot(aes(x = Bout_length, fill = BreedingStage)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
View(sub_session_behaviours)
View(behaviours)
View(sub_session_behaviours)
View(individual_bout)
View(sub_session_behaviours)
individual_bout %>%
ggplot(aes(x = Bout_length, fill = BreedingStage)) +
geom_density(alpha = 0.5) +  # Adjust transparency with alpha
labs(title = "Density Plot by Pair",
x = "Bout length",
y = "Density") +
theme_minimal()
individual_bout %>%
filter(BreedingStage = "Digging, Building")
individual_bout %>%
filter(BreedingStage == "Digging, Building")
View(individual_bout)
glm(data = individual_bout, formula = Bout_length ~ 1, family = Gamma)
glm(data = individual_bout, formula = Bout_length ~ 1, family = Poisson)
glm(data = individual_bout, formula = Bout_length ~ 1, family = oisson)
glm(data = individual_bout, formula = Bout_length ~ 1, family = poisson)
library(randomForest)
install.packages("randomForest")
library(randomForest)
ind <- sample(2, nrow(individual_bout), replace = TRUE, prob = c(0.7, 0.3))
train <- individual_bout[ind==1,]
test <- individual_bout[ind==2,]
rf <- randomForest(Bird_in~., data=train, proximity=TRUE)
individual_bout %>%
mutate(Nb_bird = as.factor(Nb_bird))
individual_bout %>%
mutate(Nb_bird = as.factor(Nb_bird))
set.seed(222)
ind <- sample(2, nrow(individual_bout), replace = TRUE, prob = c(0.7, 0.3))
train <- individual_bout[ind==1,]
test <- individual_bout[ind==2,]
rf <- randomForest(Bird_in~., data=train, proximity=TRUE)
names(individual_bout)
rf <- randomForest(Bird_in ~ TimeAction + BreedingStage + Pair + Nest + Date + Bout_length + Sex + Id_bird, data=train, proximity=TRUE)
print(rf)
rf <- randomForest(Bird_in ~ TimeAction + BreedingStage + Pair + Nest + Date + Bout_length + Sex + Id_bird, data=train)
